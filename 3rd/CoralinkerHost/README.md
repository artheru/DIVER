# Coralinker DIVER Host

ASP.NET Core + Vue 3 Web åº”ç”¨ï¼Œç”¨äº DIVER MCU èŠ‚ç‚¹çš„å¯è§†åŒ–ç¼–ç¨‹å’Œæ§åˆ¶ã€‚

**ç«¯å£**: 4499 (ç”Ÿäº§) / 5173 (å¼€å‘å‰ç«¯) / 5000 (å¼€å‘åç«¯)

---

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ClientApp (Vue 3)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  GraphCanvas â”‚  â”‚VariablePanelâ”‚  â”‚    TerminalPanel    â”‚      â”‚
â”‚  â”‚  (vue-flow) â”‚  â”‚             â”‚  â”‚ Terminal â”‚ Build    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                â”‚               â”‚          â”‚            â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”       â”‚
â”‚         â”‚  â”‚     Pinia Stores (runtime, logs, files)    â”‚       â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                â”‚                                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€ HTTP REST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                          â”‚     SignalR (terminalLine/buildLine)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Host (ASP.NET Core)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ApiRoutes  â”‚  â”‚RuntimeSession   â”‚  â”‚TerminalBroadcasterâ”‚    â”‚
â”‚  â”‚             â”‚  â”‚Service          â”‚  â”‚ terminalLine     â”‚     â”‚
â”‚  â”‚             â”‚  â”‚                 â”‚  â”‚ buildLine        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DIVERSession (SDK)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  NodeEntry (å†…éƒ¨)                                           â”‚ â”‚
â”‚  â”‚  - UUID å”¯ä¸€æ ‡è¯†                                            â”‚ â”‚
â”‚  â”‚  - Version, Layout (ç¡¬ä»¶ä¿¡æ¯)                               â”‚ â”‚
â”‚  â”‚  - NodeName, PortConfigs, ExtraInfo (ç”¨æˆ·é…ç½®)              â”‚ â”‚
â”‚  â”‚  - ProgramBytes, MetaJson, LogicName (ä»£ç )                 â”‚ â”‚
â”‚  â”‚  - Handle, State, Stats (è¿è¡Œæ—¶)                            â”‚ â”‚
â”‚  â”‚  - NodeLogBuffer (æ—¥å¿—, seq åˆ†é¡µ)                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  - èŠ‚ç‚¹ç®¡ç†: AddNode, RemoveNode, ConfigureNode, ProgramNode     â”‚
â”‚  - ä¼šè¯æ§åˆ¶: Start, Stop                                         â”‚
â”‚  - æ•°æ®ç®¡ç†: GetAllCartFieldMetas, GetAllCartFields, SetCartFieldâ”‚
â”‚  - æ—¥å¿—ç®¡ç†: GetNodeLogs (seq åˆ†é¡µ)                              â”‚
â”‚  - å¯¼å…¥å¯¼å‡º: ExportNodes, ImportNodes                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒè®¾è®¡**ï¼šDIVERSession æ˜¯èŠ‚ç‚¹æ•°æ®çš„å”¯ä¸€çœŸå®æ¥æºï¼Œå‰ç«¯é€šè¿‡ API è·å–/ä¿®æ”¹æ•°æ®ã€‚

---

## å¿«é€Ÿå¼€å§‹

```powershell
# å‰ç«¯å¼€å‘
cd ClientApp
npm install
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# å¯åŠ¨åç«¯
cd ..
dotnet run
```

---

## ç›®å½•ç»“æ„

```
3rd/CoralinkerHost/
â”œâ”€â”€ ClientApp/               # Vue 3 + Vite å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/             # HTTP API å°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ device.ts    # èŠ‚ç‚¹ç®¡ç† (addNode, configureNode, ...)
â”‚   â”‚   â”‚   â”œâ”€â”€ runtime.ts   # è¿è¡Œæ§åˆ¶ (start, stop, variables, logs)
â”‚   â”‚   â”‚   â””â”€â”€ project.ts   # é¡¹ç›®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ stores/          # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ project.ts   # é¡¹ç›®çŠ¶æ€ (selectedAsset, lastBuildId)
â”‚   â”‚   â”‚   â”œâ”€â”€ runtime.ts   # è¿è¡ŒçŠ¶æ€ (nodeStates, variables, appState)
â”‚   â”‚   â”‚   â”œâ”€â”€ files.ts     # æ–‡ä»¶ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ logs.ts      # æ—¥å¿—ç®¡ç† (Terminal/Build/èŠ‚ç‚¹æ—¥å¿—)
â”‚   â”‚   â”‚   â””â”€â”€ wiretap.ts   # WireTap çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ protocol/        # åè®®è§£ææ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ modbus/      # MODBUS RTU è§£æå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ canopen/     # CANOpen + CiA 301/402 è§£æå™¨
â”‚   â”‚   â”‚   â””â”€â”€ serial/      # é€šç”¨ Serial è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ graph/       # èŠ‚ç‚¹å›¾ (Vue-flow)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GraphCanvas.vue    # ç”»å¸ƒï¼Œç›´æ¥è°ƒç”¨ API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CoralNodeView.vue  # èŠ‚ç‚¹è§†å›¾
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AddNodeDialog.vue  # æ·»åŠ èŠ‚ç‚¹å¯¹è¯æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ control/     # æ§åˆ¶é¢æ¿
â”‚   â”‚   â”‚   â””â”€â”€ variables/   # å˜é‡é¢æ¿
â”‚   â”‚   â”œâ”€â”€ types/           # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ views/
â”‚   â”‚       â”œâ”€â”€ HomeView.vue         # ä¸»é¡µé¢ï¼ˆèŠ‚ç‚¹å›¾ç¼–è¾‘å™¨ï¼‰
â”‚   â”‚       â””â”€â”€ ControlPanelView.vue # ç‹¬ç«‹é¥æ§å™¨é¡µé¢ (/control)
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ RuntimeSessionService.cs  # DIVERSession å¼‚æ­¥å°è£… + æ—¥å¿—å¹¿æ’­
â”‚   â”œâ”€â”€ ProjectStore.cs           # é¡¹ç›®æ–‡ä»¶ç®¡ç† (è°ƒç”¨ DIVERSession.Export/Import)
â”‚   â”œâ”€â”€ DiverBuildService.cs      # C# â†’ MCU ç¼–è¯‘
â”‚   â”œâ”€â”€ TerminalBroadcaster.cs    # SignalR æ¶ˆæ¯æ¨é€
â”‚   â””â”€â”€ VariableInspectorPushService.cs  # å®šæ—¶æ¨é€å˜é‡å’ŒèŠ‚ç‚¹çŠ¶æ€
â”œâ”€â”€ Web/
â”‚   â””â”€â”€ ApiRoutes.cs         # REST API ç«¯ç‚¹
â”œâ”€â”€ data/                    # è¿è¡Œæ—¶æ•°æ® (gitignored)
â”‚   â”œâ”€â”€ project.json         # é¡¹ç›®çŠ¶æ€ + èŠ‚ç‚¹æ•°æ®
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ inputs/          # ç”¨æˆ·ä»£ç  (.cs)
â”‚       â””â”€â”€ generated/       # ç¼–è¯‘äº§ç‰© (.bin, .bin.json)
â””â”€â”€ wwwroot/                 # å‰ç«¯æ„å»ºäº§ç‰©
```

---

## æ ¸å¿ƒæµç¨‹

### èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ

```
1. Add Node (æ¢æµ‹å¹¶æ·»åŠ )
   POST /api/node/add { mcuUri: "serial://name=COM3&baudrate=1000000" }
   â†’ DIVERSession.AddNode()
   â†’ è¿”å› { uuid, nodeName: "Node-1-abc12345", version, layout }
   â†’ å‰ç«¯ GraphCanvas.addNode() æ·»åŠ åˆ°ç”»å¸ƒ

2. Configure Node (è®¾ç½®ä½ç½®ã€ç«¯å£é…ç½®)
   POST /api/node/{uuid}/configure
   { nodeName?, portConfigs?, extraInfo: { x, y } }
   â†’ DIVERSession.ConfigureNode()
   â†’ èŠ‚ç‚¹æ‹–æ‹½åœæ­¢æ—¶è‡ªåŠ¨ä¿å­˜ä½ç½®

3. Program Node (è®¾ç½®ä»£ç )
   POST /api/node/{uuid}/program { logicName: "TestLogic" }
   â†’ ä» generated/ è¯»å– .bin + .bin.json
   â†’ DIVERSession.ProgramNode()

4. Start (å¯åŠ¨ä¼šè¯)
   POST /api/start
   â†’ DIVERSession.Start()
   â†’ å¯¹æ¯ä¸ªèŠ‚ç‚¹: Open â†’ Configure â†’ Program â†’ Start
   â†’ è¿”å› { successNodes, totalNodes, errors[] }
   â†’ éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥ä¸é˜»å¡æˆåŠŸçš„èŠ‚ç‚¹

5. Running (è¿è¡Œä¸­)
   â†’ å˜é‡äº¤æ¢: UpperIO (å¯å†™) / LowerIO (åªè¯»)
   â†’ SignalR æ¨é€: VarsSnapshot (200ms), NodeSnapshot (500ms)
   â†’ Graph è‡ªåŠ¨é”å®šï¼ˆä¸å¯æ‹–åŠ¨/è¿æ¥/åˆ é™¤èŠ‚ç‚¹ï¼‰
   â†’ Build/Start æŒ‰é’®äº’æ–¥

6. Stop (åœæ­¢ä¼šè¯)
   POST /api/stop
   â†’ DIVERSession.Stop()
   â†’ å¯¹æ¯ä¸ªèŠ‚ç‚¹: Reset â†’ Close â†’ æ¸…ç† Handle
```

### å‰ç«¯æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GraphCanvas.vue                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  nodes: Node[] (vue-flow æœ¬åœ°çŠ¶æ€)                           â”‚â”‚
â”‚  â”‚  - ä½ç½®ä¿¡æ¯ (position.x, position.y)                         â”‚â”‚
â”‚  â”‚  - èŠ‚ç‚¹æ•°æ® (data.nodeName, data.runState, ...)              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚ loadFromStore()     onNodeDragStop()                   â”‚
â”‚         â–¼                     â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ GET /api/nodesâ”‚      â”‚ POST configureâ”‚                        â”‚
â”‚  â”‚ (NodeFullInfo)â”‚      â”‚ extraInfo:x,y â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ èŠ‚ç‚¹çŠ¶æ€æ›´æ–°
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        runtime store                             â”‚
â”‚  nodeStates: Map<uuid, NodeStateSnapshot>                        â”‚
â”‚  â† SignalR NodeSnapshot / GET /api/nodes/state                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å˜é‡æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     200ms       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend     â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   Backend      â”‚
â”‚                â”‚   VarsSnapshot  â”‚                â”‚
â”‚   runtime.ts   â”‚                 â”‚ VariableInspectorâ”‚
â”‚   variables    â”‚                 â”‚ PushService    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
       â”‚  POST /api/variable/set          â”‚ GetAllCartFields
       â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DIVERSession                       â”‚
â”‚                   CartFields                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## API ç«¯ç‚¹

### èŠ‚ç‚¹ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/node/probe` | POST | åªæ¢æµ‹ï¼Œä¸æ·»åŠ  |
| `/api/node/add` | POST | æ¢æµ‹å¹¶æ·»åŠ èŠ‚ç‚¹ï¼Œè¿”å› UUID |
| `/api/node/{uuid}/remove` | POST | åˆ é™¤èŠ‚ç‚¹ |
| `/api/node/{uuid}/configure` | POST | é…ç½®èŠ‚ç‚¹ (åç§°ã€ç«¯å£ã€ä½ç½®) |
| `/api/node/{uuid}/program` | POST | è®¾ç½®èŠ‚ç‚¹ä»£ç  |
| `/api/node/{uuid}` | GET | è·å–èŠ‚ç‚¹å®Œæ•´ä¿¡æ¯ |
| `/api/nodes` | GET | è·å–æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ |
| `/api/nodes/state` | GET | è·å–æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ |
| `/api/nodes/export` | GET | å¯¼å‡ºèŠ‚ç‚¹æ•°æ® |
| `/api/nodes/import` | POST | å¯¼å…¥èŠ‚ç‚¹æ•°æ® |
| `/api/nodes/clear` | POST | æ¸…ç©ºæ‰€æœ‰èŠ‚ç‚¹ |

### ä¼šè¯æ§åˆ¶

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/start` | POST | å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ |
| `/api/stop` | POST | åœæ­¢æ‰€æœ‰èŠ‚ç‚¹ |
| `/api/session/state` | GET | ä¼šè¯çŠ¶æ€ (Idle/Running) |

### å˜é‡ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/variables/meta` | GET | è·å–å­—æ®µå…ƒä¿¡æ¯ï¼ˆä¸éœ€è¦ Startï¼Œç”¨äºé¥æ§å™¨ç»‘å®šï¼‰ |
| `/api/variables` | GET | è·å–æ‰€æœ‰å˜é‡ï¼ˆéœ€è¦ Startï¼‰ |
| `/api/variable/set` | POST | è®¾ç½®å˜é‡å€¼ |
| `/api/variable/{name}` | GET | è·å–å•ä¸ªå˜é‡ |

### æ—¥å¿—ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/logs/nodes` | GET | æœ‰æ—¥å¿—çš„èŠ‚ç‚¹åˆ—è¡¨ |
| `/api/logs/node/{uuid}?afterSeq=&maxCount=` | GET | è·å–æ—¥å¿— (seq åˆ†é¡µ) |
| `/api/logs/node/{uuid}/clear` | POST | æ¸…ç©ºæ—¥å¿— |
| `/api/logs/clear` | POST | æ¸…ç©ºæ‰€æœ‰æ—¥å¿— |

### WireTap ç›‘å¬

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/node/{uuid}/wiretap` | POST | è®¾ç½®ç«¯å£ WireTap é…ç½® |
| `/api/wiretap/configs` | GET | è·å–æ‰€æœ‰èŠ‚ç‚¹çš„ WireTap é…ç½® |
| `/api/node/{uuid}/wiretap/logs` | GET | è·å–èŠ‚ç‚¹çš„ WireTap æ—¥å¿— |
| `/api/wiretap/logs` | GET | è·å–æ‰€æœ‰èŠ‚ç‚¹çš„ WireTap æ—¥å¿— |

### é¡¹ç›®ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/project` | GET/POST | é¡¹ç›®çŠ¶æ€ |
| `/api/project/new` | POST | æ–°å»ºé¡¹ç›® |
| `/api/project/save` | POST | ä¿å­˜é¡¹ç›® |
| `/api/project/export` | GET | å¯¼å‡º ZIP |
| `/api/project/import` | POST | å¯¼å…¥ ZIP |
| `/api/build` | POST | ç¼–è¯‘é€»è¾‘ |

### æ–‡ä»¶ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/files/tree` | GET | æ–‡ä»¶æ ‘ |
| `/api/files/read` | GET | è¯»å–æ–‡ä»¶ |
| `/api/files/write` | POST | å†™å…¥æ–‡ä»¶ |
| `/api/assets` | GET | èµ„æºåˆ—è¡¨ |
| `/api/logic/list` | GET | Logic åˆ—è¡¨ |
| `/api/ports` | GET | å¯ç”¨ä¸²å£ |

---

## é¡¹ç›®æ–‡ä»¶æ ¼å¼

`data/project.json`:

```json
{
  "selectedAsset": "MyLogic.cs",
  "selectedFile": "assets/generated/MyLogic.bin.json",
  "lastBuildId": "20260127-143052",
  "nodes": {
    "abc123def456...": {
      "mcuUri": "serial://name=COM3&baudrate=1000000",
      "nodeName": "Node-1-abc12345",
      "portConfigs": [
        { "type": "Serial", "name": "RS485-1", "baud": 115200, "receiveFrameMs": 0 },
        { "type": "CAN", "name": "CAN-1", "baud": 1000000, "retryTimeMs": 10 }
      ],
      "programBase64": "...",
      "metaJson": "[{\"field\":\"speed\",\"typeid\":6,\"offset\":0,\"flags\":1}]",
      "logicName": "TestLogic",
      "extraInfo": {
        "x": 250,
        "y": 150
      }
    }
  },
  "controlLayout": {
    "windowX": 100,
    "windowY": 100,
    "gridCols": 12,
    "gridRows": 12,
    "isLocked": false,
    "widgets": [
      {
        "id": "widget-1",
        "type": "joystick",
        "gridX": 0, "gridY": 0, "gridW": 5, "gridH": 7,
        "config": {
          "variableX": "inputA", "variableY": "inputB",
          "minX": -100, "maxX": 100, "minY": -100, "maxY": 100,
          "autoReturnX": true, "autoReturnY": true,
          "keyUp": "W", "keyDown": "S", "keyLeft": "A", "keyRight": "D",
          "moveSpeed": 100, "returnSpeed": 200
        }
      },
      {
        "id": "widget-2",
        "type": "slider",
        "gridX": 6, "gridY": 0, "gridW": 5, "gridH": 2,
        "config": {
          "variable": "throttle",
          "min": 0, "max": 100, "autoReturn": false,
          "keyDecrease": "Z", "keyIncrease": "X",
          "moveSpeed": 100, "returnSpeed": 200
        }
      },
      {
        "id": "widget-3",
        "type": "switch",
        "gridX": 6, "gridY": 3, "gridW": 3, "gridH": 2,
        "config": {
          "variable": "enabled", "states": 2, "keyToggle": "C"
        }
      },
      {
        "id": "widget-4",
        "type": "gauge",
        "gridX": 0, "gridY": 8, "gridW": 4, "gridH": 4,
        "config": {
          "variable": "temperature", "style": "gauge",
          "min": 0, "max": 100, "unit": "Â°C"
        }
      },
      {
        "id": "widget-5",
        "type": "lamp",
        "gridX": 5, "gridY": 8, "gridW": 3, "gridH": 2,
        "config": {
          "variable": "status", "bitCount": 8,
          "bitsPerLine": 8, "showIndex": true, "color": "#22c55e"
        }
      }
    ]
  }
}
```

---

## åç«¯æœåŠ¡

| æœåŠ¡ | èŒè´£ |
|------|------|
| `RuntimeSessionService` | DIVERSession å¼‚æ­¥å°è£… + æ—¥å¿—å¹¿æ’­ |
| `ProjectStore` | é¡¹ç›®æ–‡ä»¶ç®¡ç†ï¼Œè°ƒç”¨ DIVERSession.Export/Import |
| `DiverBuildService` | C# â†’ MCU ç¼–è¯‘ï¼Œè¾“å‡ºåˆ° Build æ—¥å¿—é¢æ¿ |
| `TerminalBroadcaster` | SignalR æ¶ˆæ¯æ¨é€ (Terminal/Build/èŠ‚ç‚¹æ—¥å¿—åˆ†ç¦») |
| `VariableInspectorPushService` | æ¯ 200ms æ¨é€å˜é‡ï¼Œæ¯ 500ms æ¨é€èŠ‚ç‚¹çŠ¶æ€ |
| `JsonHelper` | ç»Ÿä¸€ JSON åºåˆ—åŒ–é…ç½® (PascalCase â†” camelCase) |

### JSON åºåˆ—åŒ–

C# ä½¿ç”¨ PascalCaseï¼ŒJavaScript ä½¿ç”¨ camelCaseã€‚é€šè¿‡ `JsonHelper` ç»Ÿä¸€å¤„ç†ï¼š

```csharp
// Web/JsonHelper.cs
public static class JsonHelper
{
    public static readonly JsonSerializerOptions Options = new()
    {
        PropertyNamingPolicy = JsonNamingPolicy.CamelCase,      // åºåˆ—åŒ–: PascalCase â†’ camelCase
        PropertyNameCaseInsensitive = true,                      // ååºåˆ—åŒ–: ä¸åŒºåˆ†å¤§å°å†™
    };

    public static IResult Json<T>(T obj) => Results.Json(obj, Options);
}
```

æ‰€æœ‰ API ç«¯ç‚¹ä½¿ç”¨ `JsonHelper.Json()` è¿”å›æ•°æ®ï¼Œç¡®ä¿å‰åç«¯å­—æ®µååŒ¹é…ã€‚

---

## å‰ç«¯å¼€å‘

### Store èŒè´£

| Store | èŒè´£ |
|-------|------|
| `project` | selectedAsset, selectedFile, lastBuildId, controlLayout |
| `runtime` | nodeStates, nodeInfos, variables, fieldMetas, appState |
| `files` | æ–‡ä»¶æ ‘ã€æ‰“å¼€çš„ Tab |
| `logs` | Terminal/Build/èŠ‚ç‚¹æ—¥å¿—ï¼ŒBuild é”™è¯¯å¯ç‚¹å‡»è·³è½¬ |
| `ui` | é€šçŸ¥ã€å¯¹è¯æ¡† |

### å…³é”®ç»„ä»¶

| ç»„ä»¶ | è¯´æ˜ |
|------|------|
| `GraphCanvas.vue` | Vue-flow èŠ‚ç‚¹å›¾ç”»å¸ƒï¼Œè¿è¡Œæ—¶è‡ªåŠ¨é”å®šäº¤äº’ |
| `CoralNodeView.vue` | MCU èŠ‚ç‚¹è§†å›¾ï¼Œå«å‡çº§æŒ‰é’®ã€ç«¯å£é…ç½®ã€IO çŠ¶æ€ |
| `AddNodeDialog.vue` | æ·»åŠ èŠ‚ç‚¹å¯¹è¯æ¡†ï¼Œè°ƒç”¨ addNode API |
| `UpgradeDialog.vue` | å›ºä»¶å‡çº§å¯¹è¯æ¡†ï¼ˆæ”¯æŒä» Node è§†å›¾ç›´æ¥æ‰“å¼€ï¼‰ |
| `TerminalPanel.vue` | ç»ˆç«¯é¢æ¿ (Terminal/Build æ ‡ç­¾åˆ†ç¦»ï¼ŒBuild/Start äº’æ–¥) |
| `VariablePanel.vue` | å˜é‡è¡¨æ ¼ + ç¼–è¾‘ |
| `ControlWindow.vue` | é¥æ§å™¨é¢æ¿ï¼ˆæ‘‡æ†ã€æ»‘å—ã€å¼€å…³ã€ä»ªè¡¨ç›˜ã€æŒ‡ç¤ºç¯ï¼‰ |
| `FatalErrorDialog.vue` | MCU é”™è¯¯å¼¹çª—ï¼Œæ”¯æŒè·³è½¬åˆ°æºä»£ç  |

### é¥æ§å™¨é¢æ¿

ControlWindow æä¾›å¯æ‹–æ‹½ã€å¯è°ƒæ•´å¤§å°çš„é¥æ§å™¨çª—å£ï¼Œæ”¯æŒäº”ç§æ§ä»¶ï¼š

| æ§ä»¶ | è¯´æ˜ | é”®ç›˜ç»‘å®š |
|------|------|----------|
| **Joystick** | åŒè½´æ‘‡æ†ï¼Œç»‘å®š X/Y ä¸¤ä¸ªå˜é‡ | ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘é”®ï¼Œæ”¯æŒ WASD/IJKL/æ–¹å‘é”®é¢„è®¾ |
| **Slider** | å•è½´æ»‘å—ï¼Œç»‘å®šä¸€ä¸ªå˜é‡ | +/- ä¸¤ä¸ªæ–¹å‘é”®ï¼Œæ”¯æŒ ZX/NM/RF ç­‰é¢„è®¾ |
| **Switch** | å¼€å…³ï¼Œç»‘å®šä¸€ä¸ª bool å˜é‡ | å•é”®åˆ‡æ¢ï¼Œæ”¯æŒ C/V/B é¢„è®¾ |
| **Gauge** | åªè¯»ä»ªè¡¨ç›˜ï¼Œæ”¯æŒçº¯æ–‡æœ¬/è¿›åº¦æ¡/ä»ªè¡¨ç›˜æ ·å¼ | æ— ï¼ˆåªè¯»ï¼‰ |
| **Lamp** | åªè¯» LED æŒ‡ç¤ºç¯ï¼Œæ˜¾ç¤ºäºŒè¿›åˆ¶ä½çŠ¶æ€ | æ— ï¼ˆåªè¯»ï¼‰ |

**æ§ä»¶æ§åˆ¶ç‰¹æ€§**ï¼š
- Joystick/Slider æ”¯æŒè‡ªåŠ¨å›å¼¹ï¼Œå›å¼¹ä½ç½®ç”¨ç™¾åˆ†æ¯”è®¾ç½®ï¼ˆ0-100%ï¼Œé»˜è®¤ 50%ï¼‰
- é”®ç›˜ç»‘å®šåœ¨è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶è‡ªåŠ¨ç¦ç”¨

**Gauge ä»ªè¡¨ç›˜ç‰¹æ€§**ï¼š
- æ˜¾ç¤ºæ ·å¼ï¼šçº¯æ–‡æœ¬ï¼ˆæ•°å€¼/å­—ç¬¦ä¸²ï¼‰ã€æ°´å¹³/å‚ç›´è¿›åº¦æ¡ã€ä»ªè¡¨ç›˜
- ä»ªè¡¨ç›˜æ¨¡å¼æ˜¾ç¤º 5 ä¸ªåˆ»åº¦æ•°å­—ï¼ˆ0%, 25%, 50%, 75%, 100%ï¼‰
- è¶…å‡ºèŒƒå›´æ—¶æŒ‡é’ˆå˜çº¢ï¼Œå¯è¶…å‡º 180Â° æœ€å¤§çº¦ Â±20Â°
- ä¸¥é‡è¶…é™æ—¶ï¼ˆ>110Â°ï¼‰æŒ‡é’ˆæŠ–åŠ¨è­¦ç¤º

**Lamp æŒ‡ç¤ºç¯ç‰¹æ€§**ï¼š
- å¯ç»‘å®šä»»æ„æ•°å€¼å˜é‡ï¼ˆi8/u8/i16/u16/i32/u32ï¼‰
- æ”¯æŒå¤šä½æ˜¾ç¤ºï¼ˆé»˜è®¤ 1 ä½ï¼‰ï¼Œæ¯ 8 ä½ä¸€è¡Œ
- å¯è‡ªå®šä¹‰ LED é¢œè‰²
- ä½ç´¢å¼•ä» 0 å¼€å§‹é€’å¢

**é€šç”¨ç‰¹æ€§**ï¼š
- ç½‘æ ¼å¸ƒå±€ï¼ˆé»˜è®¤ 12x12 æ ¼ï¼Œæ¯æ ¼ 32pxï¼‰
- æ§ä»¶å¯æ‹–æ‹½ã€å¯è°ƒæ•´å¤§å°
- å¸ƒå±€é”å®šåŠŸèƒ½
- å¸ƒå±€æŒä¹…åŒ–åˆ° `projectStore.controlLayout`
- å­—æ®µå…ƒä¿¡æ¯åœ¨é¡µé¢åŠ è½½æ—¶è·å–ï¼ˆ`/api/variables/meta`ï¼‰ï¼Œæ— éœ€ Start å³å¯é…ç½®ç»‘å®š
- **å˜é‡åˆ—è¡¨åŒºåˆ†**ï¼šå¯æ§å˜é‡ï¼ˆç»¿è‰²èƒŒæ™¯ï¼‰å’Œåªè¯»å˜é‡ï¼ˆæ©™è‰²èƒŒæ™¯ï¼‰
- **è§¦æ‘¸è®¾å¤‡æ”¯æŒ**ï¼šè‡ªåŠ¨æ£€æµ‹è§¦æ‘¸è®¾å¤‡ï¼Œéšè—é”®ç›˜ç»‘å®šæ˜¾ç¤ºï¼Œæ”¯æŒè§¦æ‘¸æ‹–åŠ¨æ“ä½œ

**ç‹¬ç«‹é¡µé¢** `/control`ï¼š
- ç®€æ´çš„åªè¯»é¥æ§å™¨ç•Œé¢ï¼Œé€‚åˆæ‰‹æœº/å¹³æ¿ä½¿ç”¨
- é¡¶éƒ¨çŠ¶æ€æ æ˜¾ç¤ºè¿è¡ŒçŠ¶æ€å’Œ Start/Stop æŒ‰é’®
- å¸ƒå±€é”å®šï¼Œåªèƒ½æ“æ§ä¸èƒ½ä¿®æ”¹é…ç½®

### æ—¥å¿—é¢æ¿

TerminalPanel åŒ…å«ä¸¤ä¸ªç‹¬ç«‹æ ‡ç­¾ï¼š

| æ ‡ç­¾ | å†…å®¹ | è¯´æ˜ |
|------|------|------|
| **Terminal** | è¿è¡Œæ—¶æ—¥å¿— | Start/Stopã€ç³»ç»Ÿæ¶ˆæ¯ã€SignalR çŠ¶æ€ |
| **Build** | ç¼–è¯‘æ—¥å¿— | MSBuild è¾“å‡ºï¼Œæ¯æ¬¡ Build è‡ªåŠ¨æ¸…ç©º |

**Build é”™è¯¯è·³è½¬**ï¼šç¼–è¯‘é”™è¯¯è¡Œ (å¦‚ `TestLogic.cs(107,31): error CS1026`) å¯ç‚¹å‡»è·³è½¬åˆ°æºä»£ç å¯¹åº”è¡Œã€‚

### WireTap ç«¯å£ç›‘å¬

WireTap åŠŸèƒ½å…è®¸å®æ—¶ç›‘å¬ MCU ç«¯å£ï¼ˆSerial/CANï¼‰çš„é€šä¿¡æ•°æ®ï¼Œç”¨äºè°ƒè¯•å’Œåè®®åˆ†æã€‚

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- åœ¨èŠ‚ç‚¹è§†å›¾çš„ç«¯å£ç»Ÿè®¡åŒºåŸŸç‚¹å‡» TX/RX åœ†ç‚¹å¯ç”¨/ç¦ç”¨ç›‘å¬
- æ”¯æŒ Serial å’Œ CAN ä¸¤ç§ç«¯å£ç±»å‹
- æ—¥å¿—é¢æ¿æ˜¾ç¤ºå¤šåˆ—è§†å›¾ï¼šConsole + å„ç«¯å£æ—¥å¿—
- æ•°æ®æ”¯æŒæŠ˜å /å±•å¼€ï¼ˆè¶…è¿‡ 16 å­—èŠ‚è‡ªåŠ¨æŠ˜å ï¼‰
- é€‰ä¸­åå…­è¿›åˆ¶æ•°æ®å¯ Inspect æŸ¥çœ‹å¤šç§æ•°æ®è§£æï¼ˆu16/i16/u32/f32 ç­‰ï¼‰
- æ—¥å¿—å­˜å‚¨åœ¨ DIVERSession å†…å­˜ä¸­ï¼ˆæœ€å¤§ 10000 æ¡ï¼‰ï¼Œåˆ·æ–°é¡µé¢ä¸ä¸¢å¤±
- Start æ—¶æ¸…ç©ºæ—¥å¿—ï¼ŒStop æ—¶ä¿ç•™æ—¥å¿—å’Œè®¡æ•°å™¨

**åè®®è§£æåŠŸèƒ½**ï¼š
- ç‚¹å‡»æ—¥å¿—æ¡ç›®æ—çš„ ğŸ” æŒ‰é’®å¯è¿›è¡Œåè®®è§£æ
- æ”¯æŒçš„åè®®ï¼š
  - **MODBUS RTU** (Serial)ï¼šåŠŸèƒ½ç è§£æã€CRC æ ¡éªŒã€å¯„å­˜å™¨å€¼è§£æ
  - **CANOpen** (CAN)ï¼šNMTã€SDOã€PDOã€Heartbeatã€Emergency è§£æ
  - **CiA 301**ï¼šé€šä¿¡é…ç½®å¯¹è±¡å­—å…¸ï¼ˆ0x1000 åŒºåŸŸï¼‰
  - **CiA 402**ï¼šé©±åŠ¨å™¨é…ç½®ï¼ˆControlwordã€Statuswordã€è¿è¡Œæ¨¡å¼ç­‰ï¼‰
- åè®®è§£ææ¶æ„å¯æ‰©å±•ï¼Œä½äº `ClientApp/src/protocol/`

### SignalR äº‹ä»¶

| äº‹ä»¶ | æ–¹å‘ | é¢‘ç‡/è¯´æ˜ |
|------|------|------|
| `terminalLine` | Serverâ†’Client | ç»ˆç«¯æ—¥å¿—è¡Œï¼ˆå®æ—¶ï¼‰ |
| `buildLine` | Serverâ†’Client | Build æ—¥å¿—è¡Œï¼ˆç¼–è¯‘æ—¶ï¼‰ |
| `nodeLogLine` | Serverâ†’Client | èŠ‚ç‚¹æ—¥å¿— (uuid, message)ï¼ˆå®æ—¶ï¼‰ |
| `varsSnapshot` | Serverâ†’Client | å˜é‡å¿«ç…§ï¼ˆ**200ms**ï¼‰ |
| `nodeSnapshot` | Serverâ†’Client | èŠ‚ç‚¹çŠ¶æ€å¿«ç…§ï¼ˆ**500ms**ï¼Œå« TX/RX/IOï¼‰ |
| `wiretapdata` | Serverâ†’Client | WireTap ç«¯å£æ•°æ®ï¼ˆå®æ—¶ï¼Œå« Serial/CAN æ•°æ®ï¼‰ |
| `fatalError` | Serverâ†’Client | MCU Fatal Error (HardFault/ASSERT)ï¼ˆå®æ—¶ï¼‰ |
| `upgradeProgress` | Serverâ†’Client | å›ºä»¶å‡çº§è¿›åº¦ï¼ˆå®æ—¶ï¼‰ |

**è¿è¡Œæ—¶æ•°æ®æµ**ï¼šåç«¯æ¯ 500ms ä»ä¸‹ä½æœºè½®è¯¢çŠ¶æ€ï¼ŒåŒæ—¶é€šè¿‡ SignalR æ¨é€åˆ°å‰ç«¯ã€‚å‰ç«¯ä¸å†éœ€è¦ HTTP è½®è¯¢ã€‚

### ç±»å‹å®šä¹‰ (`types/index.ts`)

```typescript
// èŠ‚ç‚¹å®Œæ•´ä¿¡æ¯
interface NodeFullInfo {
  uuid: string
  mcuUri: string
  nodeName: string
  version?: VersionInfo
  layout?: LayoutInfo       // ç¡¬ä»¶å¸ƒå±€ (ports, IO counts)
  portConfigs: PortConfig[]
  hasProgram: boolean
  logicName?: string
  extraInfo?: { x?: number, y?: number }
}

// èŠ‚ç‚¹çŠ¶æ€å¿«ç…§
interface NodeStateSnapshot {
  uuid: string
  mcuUri: string
  nodeName: string
  isConnected: boolean
  runState: string  // "idle" | "running" | "error" | "offline"
  isConfigured: boolean
  isProgrammed: boolean
  stats?: RuntimeStats
}

// ç¡¬ä»¶å¸ƒå±€
interface LayoutInfo {
  digitalInputCount: number
  digitalOutputCount: number
  portCount: number
  ports: PortDescriptor[]
}

// å­—æ®µå…ƒä¿¡æ¯ï¼ˆç”¨äºé¥æ§å™¨ç»‘å®šï¼Œä¸éœ€è¦ Startï¼‰
interface CartFieldMeta {
  name: string
  type: string
  typeId: number
  isLowerIO: boolean   // åªè¯»å­—æ®µ
  isUpperIO: boolean   // å¯å†™å­—æ®µ
  isMutual: boolean    // åŒå‘å­—æ®µ
}

// é¥æ§å™¨å¸ƒå±€
interface ControlLayoutConfig {
  windowX: number
  windowY: number
  gridCols: number
  gridRows: number
  isLocked: boolean
  widgets: ControlWidget[]
}
```

---

## å¸¸è§é—®é¢˜

### èŠ‚ç‚¹æ·»åŠ å¤±è´¥

- æ£€æŸ¥ä¸²å£æ˜¯å¦è¢«å ç”¨
- ç¡®è®¤ MCU å›ºä»¶ç‰ˆæœ¬æ­£ç¡®
- æŸ¥çœ‹ç»ˆç«¯æ—¥å¿—çš„é”™è¯¯ä¿¡æ¯

### Start å¤±è´¥

- ç¡®ä¿å·² Build ä¸” ProgramNode è®¾ç½®äº†ä»£ç 
- æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦éƒ½æœ‰ LogicName
- éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥ä¼šè¿”å› errors æ•°ç»„ï¼ŒæˆåŠŸçš„èŠ‚ç‚¹ä»ä¼šè¿è¡Œ

### å˜é‡ä¸æ›´æ–°

- æ£€æŸ¥ SignalR è¿æ¥çŠ¶æ€
- LowerIO å­—æ®µåªè¯»ï¼Œä¸èƒ½è®¾ç½®
- ç¡®è®¤èŠ‚ç‚¹å¤„äº Running çŠ¶æ€
- Build å®Œæˆåä¼šè‡ªåŠ¨åˆ·æ–°å˜é‡åˆ—è¡¨ï¼ˆåˆ é™¤/ä¿®æ”¹å˜é‡åé‡æ–°ç¼–è¯‘å³å¯æ›´æ–°ï¼‰

### æ—¥å¿—é‡å¤

**èŠ‚ç‚¹æ—¥å¿—**ï¼š
- ä½¿ç”¨ `afterSeq` å‚æ•°è·å–æ–°æ—¥å¿—
- é¦–æ¬¡è·å–æ—¶ä¸ä¼  afterSeq
- logs store è‡ªåŠ¨ç®¡ç† lastSeq

**ç»ˆç«¯/Build æ—¥å¿—**ï¼š
- SignalR è¿æ¥ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œé¿å…å¤šä¸ªç»„ä»¶åˆ›å»ºé‡å¤è¿æ¥
- `useSignalR()` composable çš„ connection/state å®šä¹‰åœ¨æ¨¡å—çº§åˆ«
- å¦‚æœä»ç„¶å‡ºç°é‡å¤ï¼Œæ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ‰“å¼€äº†å¤šä¸ªæ ‡ç­¾é¡µ

### èŠ‚ç‚¹ä½ç½®ä¸ä¿å­˜

- èŠ‚ç‚¹ä½ç½®å­˜å‚¨åœ¨ `extraInfo.x, extraInfo.y`
- æ‹–æ‹½åœæ­¢æ—¶è‡ªåŠ¨è°ƒç”¨ `configureNode` ä¿å­˜
- æ£€æŸ¥åç«¯æ˜¯å¦è¿”å› ok

### Logic ä¸ä¿å­˜

- é€‰æ‹© Logic åä¼šè°ƒç”¨ `/api/node/{uuid}/program` API
- Logic æ•°æ®å­˜å‚¨åœ¨ DIVERSession ä¸­ï¼Œå‰ç«¯ dirty æ£€æŸ¥ä¸ä¼šè§¦å‘
- ç‚¹å‡» Save æ€»æ˜¯ä¼šè°ƒç”¨åç«¯ä¿å­˜ï¼ˆä¸ä¾èµ– dirty çŠ¶æ€ï¼‰

### èŠ‚ç‚¹æ“ä½œåæ•°æ®ä¸¢å¤±

- æ‰€æœ‰èŠ‚ç‚¹æ“ä½œï¼ˆæ·»åŠ ã€åˆ é™¤ã€é‡å‘½åã€é…ç½®ç«¯å£ã€é€‰æ‹© Logicï¼‰éƒ½ä¼šè‡ªåŠ¨ä¿å­˜åˆ°ç£ç›˜
- æ— éœ€æ‰‹åŠ¨ç‚¹å‡» Save

### å›ºä»¶å‡çº§

- AddNodeDialog ä¸­ Probe æˆåŠŸåå¯å‡çº§
- CoralNodeView ä¸­ç‚¹å‡»å‡çº§æŒ‰é’®ï¼ˆâ¬†ï¼‰å¯ç›´æ¥å‡çº§å·²æ·»åŠ çš„èŠ‚ç‚¹
- å‡çº§å‰ä¼šè‡ªåŠ¨ Probe è·å–å½“å‰ç‰ˆæœ¬ä¿¡æ¯

---

## ç¼–è¾‘å™¨åŠŸèƒ½

- **Monaco Editor** è¯­æ³•é«˜äº®ã€ä»£ç è¡¥å…¨
- **Ctrl+S** ä¿å­˜å½“å‰æ–‡ä»¶
- **generated/** ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸ºåªè¯»
- **Build é”™è¯¯è·³è½¬** ç‚¹å‡»ç¼–è¯‘é”™è¯¯è¡Œå·è‡ªåŠ¨æ‰“å¼€æ–‡ä»¶å¹¶å®šä½

---

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Vue 3, Vite, TypeScript, Pinia, Vue-flow, Naive UI, Monaco Editor
- **åç«¯**: ASP.NET Core 8, SignalR
- **SDK**: CoralinkerSDK (DIVERSession)
