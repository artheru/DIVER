# Coralinker DIVER Host - Frontend

åŸºäº **Vue 3 + Vite + TypeScript** é‡æ„çš„å‰ç«¯é¡¹ç›®ï¼Œç”¨äº DIVER MCU èŠ‚ç‚¹çš„å¯è§†åŒ–ç¼–ç¨‹å’Œæ§åˆ¶ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js**: 20.19+ æˆ– 22.12+ æˆ– 24.xï¼ˆæ¨èæœ€æ–° LTSï¼‰
- **npm**: 10.x+

### å®‰è£…ä¾èµ–

```bash
cd 3rd/CoralinkerHost/ClientApp
npm install
```

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

è®¿é—® http://localhost:5173

### ç”Ÿäº§æ„å»º

```bash
npm run build
```

æ„å»ºäº§ç‰©è¾“å‡ºåˆ° `../wwwroot/`ï¼Œå¯ç›´æ¥ç”± ASP.NET Core åç«¯æœåŠ¡ã€‚

---

## ğŸ“ ç›®å½•ç»“æ„

```
ClientApp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                    # HTTP API å°è£…
â”‚   â”‚   â”œâ”€â”€ index.ts            # Axios å®ä¾‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ project.ts          # é¡¹ç›® API (åŠ è½½/ä¿å­˜/å¯¼å‡º/å¯¼å…¥)
â”‚   â”‚   â”œâ”€â”€ files.ts            # æ–‡ä»¶ API (èµ„æºæ ‘/è¯»å†™/ä¸Šä¼ )
â”‚   â”‚   â””â”€â”€ runtime.ts          # è¿è¡Œæ—¶ API (è¿æ¥/å¯åœ/å‘½ä»¤)
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                 # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ project.ts          # é¡¹ç›®çŠ¶æ€ (èŠ‚ç‚¹é…ç½®ã€å›¾æ•°æ®)
â”‚   â”‚   â”œâ”€â”€ runtime.ts          # è¿è¡Œæ—¶çŠ¶æ€ (è¿æ¥ã€å˜é‡å€¼)
â”‚   â”‚   â”œâ”€â”€ files.ts            # æ–‡ä»¶çŠ¶æ€ (èµ„æºæ ‘ã€ç¼–è¾‘å™¨ Tab)
â”‚   â”‚   â”œâ”€â”€ logs.ts             # æ—¥å¿—çŠ¶æ€ (ç»ˆç«¯ã€èŠ‚ç‚¹æ—¥å¿—)
â”‚   â”‚   â”œâ”€â”€ ui.ts               # UI çŠ¶æ€ (é€šçŸ¥ã€å¯¹è¯æ¡†)
â”‚   â”‚   â””â”€â”€ index.ts            # Store å¯¼å‡ºæ±‡æ€»
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/            # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ useSignalR.ts       # SignalR å®æ—¶é€šä¿¡
â”‚   â”‚   â”œâ”€â”€ useAutoSave.ts      # è‡ªåŠ¨ä¿å­˜é€»è¾‘
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ components/             # Vue ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ graph/              # èŠ‚ç‚¹å›¾ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â””â”€â”€ GraphCanvas.vue # LiteGraph ç”»å¸ƒå°è£…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ editor/             # ä»£ç ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ CodeEditor.vue  # Monaco Editor å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ HexEditor.vue   # åå…­è¿›åˆ¶ç¼–è¾‘å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ assets/             # èµ„æºç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ AssetTree.vue   # æ–‡ä»¶æ ‘ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ TreeNode.vue    # æ ‘èŠ‚ç‚¹ï¼ˆé€’å½’ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ variables/          # å˜é‡é¢æ¿
â”‚   â”‚   â”‚   â””â”€â”€ VariablePanel.vue
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ logs/               # æ—¥å¿—é¢æ¿
â”‚   â”‚   â”‚   â””â”€â”€ TerminalPanel.vue
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ control/            # æ§åˆ¶é¢æ¿æ§ä»¶
â”‚   â”‚       â”œâ”€â”€ SliderWidget.vue
â”‚   â”‚       â”œâ”€â”€ JoystickWidget.vue
â”‚   â”‚       â”œâ”€â”€ SwitchWidget.vue
â”‚   â”‚       â””â”€â”€ WidgetConfigForm.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ views/                  # é¡µé¢è§†å›¾
â”‚   â”‚   â”œâ”€â”€ HomeView.vue        # ä¸»é¡µ (èŠ‚ç‚¹å›¾ + ç¼–è¾‘å™¨ + é¢æ¿)
â”‚   â”‚   â””â”€â”€ ControlPanelView.vue # æ§åˆ¶é¢æ¿é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                  # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ index.ts            # ä¸šåŠ¡ç±»å‹
â”‚   â”‚   â””â”€â”€ litegraph.d.ts      # LiteGraph ç±»å‹å£°æ˜
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ main.css            # å…¨å±€æ ·å¼ + CSS å˜é‡
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue                 # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.ts                 # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ router.ts               # è·¯ç”±é…ç½®
â”‚
â”œâ”€â”€ index.html                  # HTML å…¥å£
â”œâ”€â”€ vite.config.ts              # Vite é…ç½®
â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®
â””â”€â”€ package.json
```

---

## ğŸ”„ æ•°æ®æµä¸å·¥ä½œæµç¨‹

### 1. åº”ç”¨å¯åŠ¨æµç¨‹

```
main.ts
  â””â”€ createApp(App)
       â”œâ”€ Pinia (çŠ¶æ€ç®¡ç†)
       â”œâ”€ Router (è·¯ç”±)
       â””â”€ Naive UI (ç»„ä»¶åº“)

App.vue
  â””â”€ onMounted
       â”œâ”€ projectStore.loadProject()   # ä»åç«¯åŠ è½½é¡¹ç›®
       â”œâ”€ filesStore.loadFileTree()    # åŠ è½½èµ„æºæ ‘
       â””â”€ useSignalR().connect()       # å»ºç«‹ SignalR è¿æ¥
```

### 2. æ ¸å¿ƒæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP REST      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Backend    â”‚
â”‚   (Vue 3)    â”‚                    â”‚  (ASP.NET)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                   â”‚
       â”‚   SignalR (å®æ—¶)                   â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚   - æ—¥å¿—æ¨é€                       â”‚
       â”‚   - å˜é‡å€¼æ›´æ–°                     â”‚
       â”‚   - èŠ‚ç‚¹çŠ¶æ€å˜åŒ–                   â”‚
       â”‚                                   â”‚
       â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pinia Stores â”‚                    â”‚  MCU Nodes   â”‚
â”‚  - project   â”‚                    â”‚  (Serial)    â”‚
â”‚  - runtime   â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  - files     â”‚
â”‚  - logs      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. å…³é”® API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/project` | GET | è·å–é¡¹ç›®çŠ¶æ€ |
| `/api/project` | POST | æ›´æ–°é¡¹ç›®çŠ¶æ€ |
| `/api/project/new` | POST | æ–°å»ºé¡¹ç›® |
| `/api/project/export` | GET | å¯¼å‡ºé¡¹ç›® JSON |
| `/api/project/import` | POST | å¯¼å…¥é¡¹ç›® JSON |
| `/api/files/tree` | GET | è·å–æ–‡ä»¶æ ‘ |
| `/api/files/read` | GET | è¯»å–æ–‡ä»¶å†…å®¹ |
| `/api/files/write` | POST | å†™å…¥æ–‡ä»¶å†…å®¹ |
| `/api/runtime/connect` | POST | è¿æ¥ MCU èŠ‚ç‚¹ |
| `/api/runtime/start` | POST | å¯åŠ¨æ‰§è¡Œ |
| `/api/runtime/stop` | POST | åœæ­¢æ‰§è¡Œ |
| `/api/runtime/command` | POST | å‘é€å‘½ä»¤ |

### 4. SignalR äº‹ä»¶

| äº‹ä»¶ | æ–¹å‘ | æè¿° |
|------|------|------|
| `TerminalLog` | Serverâ†’Client | ç»ˆç«¯æ—¥å¿—è¡Œ |
| `NodeLog` | Serverâ†’Client | èŠ‚ç‚¹æ—¥å¿—è¡Œ |
| `VariableUpdate` | Serverâ†’Client | å˜é‡å€¼æ›´æ–° |
| `NodeStateChange` | Serverâ†’Client | èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€å˜åŒ– |

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶è¯´æ˜

### GraphCanvas.vue (èŠ‚ç‚¹å›¾ç¼–è¾‘å™¨)

- å°è£… **LiteGraph.js** 
- è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹ï¼š`CoralNode` (MCUèŠ‚ç‚¹)ã€`RootNode` (æ ¹èŠ‚ç‚¹)
- æ”¯æŒ DPI ç¼©æ”¾
- è‡ªåŠ¨ä¿å­˜åˆ° Store

### CodeEditor.vue (ä»£ç ç¼–è¾‘å™¨)

- å°è£… **Monaco Editor**
- æ”¯æŒ C#ã€JSON ç­‰è¯­è¨€é«˜äº®
- é¢„ç•™ LSP æ”¯æŒæ¥å£ï¼ˆç”¨äºé™æ€åˆ†æï¼‰

### VariablePanel.vue (å˜é‡é¢æ¿)

- å®æ—¶æ˜¾ç¤º Cart å˜é‡å€¼
- å¯æ§å˜é‡æ”¯æŒå†…è”ç¼–è¾‘
- è¿æ¥/å¯åŠ¨/åœæ­¢æ§åˆ¶

### ControlPanelView.vue (æ§åˆ¶é¢æ¿)

- å¯æ‹–æ‹½æ”¾ç½®æ§ä»¶
- æ”¯æŒæ»‘å—ã€æ‘‡æ†ã€å¼€å…³æ§ä»¶
- æ§ä»¶é…ç½®æŒä¹…åŒ–

---

## ğŸ¨ æ ·å¼ç³»ç»Ÿ

ä½¿ç”¨ CSS å˜é‡å®ç°ä¸»é¢˜åŒ–ï¼Œå®šä¹‰åœ¨ `styles/main.css`ï¼š

```css
:root {
  --body-color: #0d1117;
  --panel-color: #161b22;
  --primary: #4f8cff;
  --success: #22c55e;
  --warning: #f59e0b;
  --danger: #ef4444;
  --font-mono: 'JetBrains Mono', monospace;
  /* ... */
}
```

---

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°ç»„ä»¶

1. åœ¨ `components/` ä¸‹åˆ›å»º `.vue` æ–‡ä»¶
2. ä½¿ç”¨ `<script setup lang="ts">` è¯­æ³•
3. æ ·å¼ä½¿ç”¨ `<style scoped>`

### æ·»åŠ æ–° API

1. åœ¨ `api/` ä¸‹æ·»åŠ å‡½æ•°
2. åœ¨ `stores/` ä¸­è°ƒç”¨å¹¶ç®¡ç†çŠ¶æ€

### æ·»åŠ æ–° Store

1. åœ¨ `stores/` ä¸‹åˆ›å»ºæ–‡ä»¶
2. ä½¿ç”¨ `defineStore` + Composition API
3. åœ¨ `stores/index.ts` ä¸­å¯¼å‡º

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ„å»ºäº§ç‰©ä½ç½®**ï¼šè¾“å‡ºåˆ° `../wwwroot/`ï¼Œè¢« ASP.NET Core é™æ€æ–‡ä»¶ä¸­é—´ä»¶æœåŠ¡
2. **SignalR Hub è·¯å¾„**ï¼š`/hubs/terminal`
3. **Monaco è¯­è¨€ Worker**ï¼šé€šè¿‡ Vite çš„ `?worker` è¯­æ³•å¼‚æ­¥åŠ è½½
4. **LiteGraph**ï¼šä½¿ç”¨ npm åŒ…è€Œé CDNï¼Œé€šè¿‡ `optimizeDeps` é¢„æ„å»º

---

## ğŸ› å¸¸è§é—®é¢˜

### Node.js ç‰ˆæœ¬ä¸å…¼å®¹

Vite 7 éœ€è¦ Node.js 20.19+ æˆ– 22.12+ã€‚ä½¿ç”¨ `node --version` æ£€æŸ¥ç‰ˆæœ¬ã€‚

### Monaco Editor è¯­è¨€ Worker åŠ è½½å¤±è´¥

ç¡®ä¿ `vite.config.ts` ä¸­é…ç½®äº† `optimizeDeps.include: ['monaco-editor']`ã€‚

### LiteGraph ç±»å‹é”™è¯¯

å‚è€ƒ `types/litegraph.d.ts` ä¸­çš„ç±»å‹å£°æ˜ï¼Œå¿…è¦æ—¶ä½¿ç”¨ `as any` ç»•è¿‡ã€‚
